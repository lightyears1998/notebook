# 数据库原理

## 数据库系统基本概念

- 数据库

    1. **数据** 描述事物的符号记录。
    2. **数据库** 永久储存、有组织、可共享的数据的集合。
    3. **数据库管理系统** DBMS，如MySQL、Oracle Database等。
    4. **数据库系统** 包括数据库、数据库管理系统、应用程序和数据库管理员。

- 数据独立性

    1. **物理独立性** 用户的应用程序和数据库中数据的物理储存分离。
    2. **逻辑独立性** 用户的应用程序与数据库的逻辑结构是相互独立的。

- **数据模型** 对现实世界数据特征的抽象，一般包括数据结构、数据操作和数据完整性约束条件：

    1. 概念模型 按用户的观点对信息进行建模。

        1. 实体
        2. 属性
        3. 码 唯一标志实体的**最小**属性集合。
        4. 超码 能够唯一标志实体的属性集合。

    2. 逻辑模型 包括层次模型、网状模型、关系模型、面向对象数据模型等。
    3. 物理模型 底层的储存结构。

- 数据库系统的模式

    1. 模式（逻辑模式）数据库中全体数据的逻辑结构和特征的描述。
    2. 外模式（子模式、用户模式） 数据库用户所看见和使用的局部数据的逻辑结构和特征的描述。
    3. 内模式（存储模式） 数据物理结构和存储方式的描述。

- 在模式的基础上建立的数据库的二级映像

    1. 外模式/模式映像
    2. 模式/内模式映像

## 关系基本概念

- **域** 具有相同数据类型的值的集合。

- **属性名** 对关系的一个列附加属性名以取消关系元组的有序性质。

- **关系模式** 对关系的描述

    1. 候选码 能唯一标志一个关系的最小集合（对应概念模型中“码”的概念）。
    2. 主码 选定的一个候选码。
    3. 全码 关系模式的所有属性都是这个关系的候选码。
    4. 主属性/非主属性/非码属性 候选码的所有属性称为主属性。
    5. 外码 参照关系中与被参照关系主码对应的属性（不一定是参照关系的码）。

- **关系的基本操作**

    1. 查询（选择、投影、并、差、交、笛卡尔积）
    2. 插入
    3. 修改
    4. 删除

- **关系的完整性**

    1. 实体完整性
    2. 参照完整性 A → B（参照关系 → 被参照关系，或称目标关系；A中与被参照关系的主码对应的属性称为A的外码）
    3. 用户定义的完整性

- **关系代数**

  - 传统的集合运算
    1. 并 ∪
    2. 差 -
    3. 交 ∩
    4. 笛卡尔积 X
  - 专门的关系运算
    1. 选择 σ
    2. 投影 Π
    3. 连接（θ连接） ⋈
        - 等值连接 算子为“=”的连接。
        - 自然连接 要求算子为“=”且进行比较的分量同名。
        - 悬浮元组 在操作时因为`NULL`而被舍弃的元组。
        - 外连接 将悬浮元组保留在结果集中，而将其他属性填`NULL`。
            - 左外连接/右外连接 只保留左边/右边的悬浮元组的连接。
    4. 除 A ÷ B（取A、B的公共属性集x，要求x在B上的象集是x在A上的象集的子集）

## 结构化查询语言SQL

四大分类

1. DDL *Data Definiton Language* 数据定义语言
2. DML *Data Manipulation Language* 数据操作语言
3. DQL *Data Query Language* 数据查询语言
4. DCL *Data Control Language* 数据控制语言

九个动词

1. 数据定义 `CREATE`, `DROP`, `ALTER`
2. 数据操纵 `INSERT`, `UPDATE`, `DELETE`
3. 数据查询 `SELECT`
4. 数据控制 `GRANT`, `REVOKE`

### 数据类型

1. CHAR(n), VARCHAR(n)
2. CLOB, BLOB 字符串/二级制大对象
3. INT(EGER), SMALLINT, BIGINT
4. NUMERIC(p, d), DECIMAL(p, d), DEC(p, d) p位整数，d位小数的定点数
5. REAL, DOUBLE PRECISION 单精度/双精度浮点数
6. FLOAT(n) 精度至少为n的浮点数
7. BOOLEAN
8. DATE, TIME, TIMESTAMP, INTERVAL

### SHOW/SET

- 搜索路径 `SHOW search_path`, `SET search_path TO <新路径>`

### 数据定义 DDL

1. 模式
    - 定义模式
        - `CREATE SCHEMA <模式名> AUTHORIZATION <用户名>;` 如果没有用户名，模式名隐含为用户名
        - `CREATE SCHEMA <模式名> AUTHORIZATION <用户名> [<表定义字句>|<视图定义子句>|<授权定义子句>];`
    - 删除模式 `DROP SCHEMA <模式名> <RESTRICT | CASCADE>;`
        - CASCADE 在删除模式时删除模式下的数据库对象。
        - RESTRICT 在模式下没有数据库对象时才能删除模式。

2. 表

    - 定义表

        ```sql
        CREATE TABLE <表名> (
            <列名> <数据类型> [<列级数据完整性约束条件>]
            [, ...]
            [, <表级数据完整性约束条件>]
        );
        ```

        列级数据完整性约束条件
            1. `PRIMARY KEY`
            2. `NOT NULL`
            3. `UNIQUE`

        表级数据完整性约束条件
            1. `FOREIGN KEY (<列名>) REFERENCES <表名>(<列名>)`

        表属于一个模式，定义表时可以指定表所属的模式`CREATE TABLE <模式名>.<表名> ...;`；没有显式给出模式名的表定义，由搜索路径决定归属。

    - 修改表

        ```sql
        ALTER TABLE <表名> [
            [ADD COLUMN <列名> <数据类型> <完整性约束>]
            [ADD 表级别完整性约束]
            [DROP COLUMN <列名> [RESTRICT | CASCADE]]
            [DROP CONSTRAINT <完整性约束名> [RESCRICT | CASCADE]]
            [ALTER COLUMN <列名> <数据类型>]
        ];
        ```

    - 删除表 `DROP TABLE <表名> [RESTRICT | CASCADE]`

3. 索引

    - 建立索引 `CREATE [UNIQUE] [CLUSTER] INDEX <索引名> ON <表名>([<列名> [<ASC | DESC>], ...]);`
    - 修改索引 `ALTER INDEX <索引名> RENAME TO <新索引名>;`
    - 删除索引 `DROP INDEX <索引名>;`

4. 视图

### 数据查询

```sql
SELCET [ALL | DISTINCT] <目标列或表达式>, [<目标列或表达式>, ...]
FROM <表名或视图名>, [<表名或视图名>, ...]
[WHERE <条件表达式>]
[GROUP BY <列名或表达式名> [HAVING <条件表达式>]]
[ORDER BY <列名或表达式名> [ASC | DESC]]
```

### 条件表达式

1. `NOT`
2. `IS NULL`
3. `BETWEEN ... AND ...`
4. 字符串 `LIKE "字符串"` 任意长度通配符`%` 单字符通配符`_` 转义序列 `LIKE <"待转义的字符串"> [ESCAPE <"转义序列">]`
5. 正则表达式匹配 `regexp_like("正则表达式")`

### 辅助函数

- `LOWER()`
